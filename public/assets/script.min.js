"use strict";function usrData(e,t,l=[]){if("get"===e)return null!=localStorage.getItem(t)&&"[]"!=localStorage.getItem(t)?JSON.parse(localStorage.getItem(t)):[];if("save"!==e)throw"Func param only accepts 'get' or 'save'";{let e=JSON.parse(localStorage.getItem(t))?JSON.parse(localStorage.getItem(t)):[],o=[];"string"==typeof l?o.push(l):o.push(...l),e.push(...o);let a=e.filter((t,l)=>e.indexOf(t)===l);localStorage.setItem(t,JSON.stringify(a))}}function findVisCodes(e){const t=[...e];let l=[];for(const e of t)l.push(stations[e]);return l}function addStnsToMap(e){let t=[];"string"==typeof e?t.push(e):t.push(...e),t.sort(),t.forEach(e=>{$(`[id*="${stations[e]}-dash"]`).addClass("visible"),$(`[id*="${stations[e]}-label"]`).addClass("visible"),$(`[id*="IC_${stations[e]}"]`).addClass("visible")})}function updateLineSegs(){let e=findVisCodes(usrData("get","stations")),t={bakerloo:0,central:0,piccadilly:0,jubilee:0,metropolitan:0,victoria:0,northern:0,circle:0,"hammersmith-city":0,district:0,elizabeth:0,overground:0,"waterloo-city":0,"cable-car":0,dlr:0,OSI:0};for(const n in lines){const s=lines[n];if(s.branch){function l(){let t=!1;return s.top.forEach(l=>{l.forEach(l=>{e.includes(l)&&(t=!0)})}),t}function o(){let t=!1;return s.bottom.forEach(l=>{l.forEach(l=>{e.includes(l)&&(t=!0)})}),t}function a(l,o){if(l&&o){let l=0;s.top.forEach(t=>{let o=100;t.forEach(a=>{const n=t.indexOf(a);e.includes(a)&&(l++,n<=o&&(o=n))});for(let e=o;e<t.length;e++)$(`#lul-${s.line}_${t[e]}-${t[e+1]}`).addClass("visible")}),s.bottom.forEach(t=>{let o=0;t.forEach(a=>{const n=t.indexOf(a);e.includes(a)&&(l++,n>=o&&(o=n))});for(let e=0;e<o;e++)$(`#lul-${s.line}_${t[e]}-${t[e+1]}`).addClass("visible")}),t[s.line]=t[s.line]+l}else if(l){let l=0;s.top.forEach(t=>{let o=100,a=0;t.forEach(n=>{const s=t.indexOf(n);e.includes(n)&&(l++,s<=o?o=s:s>=a&&(a=s))});for(let e=o;e<a;e++)$(`#lul-${s.line}_${t[e]}-${t[e+1]}`).addClass("visible")}),t[s.line]=t[s.line]+l}else if(o){let l=0;s.bottom.forEach(t=>{let o=100,a=0;t.forEach(n=>{const s=t.indexOf(n);e.includes(n)&&(l++,s<=o?o=s:s>=a&&(a=s))});for(let e=o;e<a;e++)$(`#lul-${s.line}_${t[e]}-${t[e+1]}`).addClass("visible")}),t[s.line]=t[s.line]+l}}a(l(),o())}else{const l=s.stations;let o=100,a=0,n=0;l.forEach(t=>{const s=l.indexOf(t);e.includes(t)&&(n++,s<o?o=s:s>a&&(a=s))});for(let e=o;e<a;e++)$(`#lul-${s.line}_${l[e]}-${l[e+1]}`).addClass("visible");t[s.line]=t[s.line]+n}}updateStats(t)}function updateStats(e){const t={bakerloo:25,central:49,piccadilly:53,jubilee:27,metropolitan:34,victoria:16,northern:52,circle:36,"hammersmith-city":29,district:60,elizabeth:32,overground:112,"waterloo-city":2,"cable-car":2,dlr:45,tram:39};for(const l in t){let o,a;if(NaN===e[l])$(`progress#${l}`).attr("value",0);else{const n=t[l];a=e[l],o=Math.floor(a/n*100),console.log(l,o)}$(`progress#${l}`).attr("value",o)}}function readFile(e){const t=new FileReader;t.readAsText(e,"UTF-8"),t.onload=(e=>{const t=e.target.result,l=CSVtoArray(t);loadData(l)}),t.onerror=(e=>{console.error(e)})}function loadData(e){let t=[],l=[];for(const o in e){const a=e[o][3];if(null!=a)if(-1!==a.toLowerCase().indexOf("bus")){const e=a.split("route ")[1];l.includes(e)||l.push(e)}else if(-1!==a.toLowerCase().indexOf(" to ")){const e=a.split(" to "),l=e.map(e=>{const t=/( \[.*\])|( DLR)|( tram stop)|(\[No touch-out\])/;return e.replace(t,"")});for(const e in l)t.includes(l[e])||t.push(l[e])}}try{usrData("save","stations",t),usrData("save","bus",l)}catch(e){console.error(`loadData(): ${e}`)}finally{updateLineSegs()}}function CSVtoArray(e,t=","){t=t||",";for(var l=new RegExp("(\\"+t+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+t+"\\r\\n]*))","gi"),o=[[]],a=null;a=l.exec(e);){var n=a[1];if(n.length&&n!=t&&o.push([]),a[2])var s=a[2].replace(new RegExp('""',"g"),'"');else s=a[3];o[o.length-1].push(s)}return o}function dragOverHandler(e){e.preventDefault(),$("body").toggleClass("dragOver")}function dropHandler(e){e.preventDefault(),$("body").toggleClass("dragOver");const t=e.dataTransfer.items[0].getAsFile();readFile(t)}function uploadHandler(e){$("#fileSelect").click(),$("#fileSelect").on("change",()=>{const e=document.getElementById("fileSelect"),t=null==e?void 0:e.files[0];readFile(t)})}